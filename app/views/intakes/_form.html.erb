<%= form_with(model: @intake, local: true) do |form| %>
  <% if @intake.errors.any? %>
    <div id="error_explanation" class="my-16 p-8 text-7xl bg-red-400 font-bold">
      <p><%= pluralize(@intake.errors.count, "error") %> prohibited this intake from being saved:</p>
      <ul class="mt-8">
        <% @intake.errors.full_messages.each do |message| %>
          <li class="text-6xl"><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="w-full flex flex-col space-y-32 mt-24 pb-24 text-6xl text-gray-800 tracking-wide">
    <%= form.fields_for :client, @client do |client_attributes|%>

      <div class="text-gray-700">
        <% question = Intake::FIRST_NAME %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold"
        %>
        <%= client_attributes.text_field question.key,
          size: 23, 
          value: @client.first_name,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::LAST_NAME %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold"
        %>
        <%= client_attributes.text_field question.key,
          size: 23, 
          value: @client.last_name,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::DATE_OF_BIRTH %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= client_attributes.date_field question.key,
          value: Date.current - 50.years,
          class: "mt-4 w-full rounded-lg p-8 text-6xl" %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::GENDER %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= client_attributes.select question.key,
          options_for_select(question.choices, @client.gender),
          {},
          class: "mt-6 rounded-lg w-full p-8 text-6xl"
        %>
      </div>

      <div class="field w-full">
        <% question = Intake::RACE %>
        <%= client_attributes.label question.key, question.text, class: "block leading-snug font-semibold" %>
        <ul class="flex flex-1 flex-col w-full space-y-12 p-12 text-6xl text-gray-700">
          <% question.choices.each do |race| %>
            <li class="flex flex-1 items-baseline">
              <%= client_attributes.check_box question.key,
                { 
                  multiple: true, 
                  checked: race.in?(@client.race || []),
                  class: "mr-8 w-11 h-11 text-indigo-600"
                },
                race
              %>
              <%= client_attributes.label "race_#{to_htmlfor(race)}", race %>
            </li>
          <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::ETHNICITY %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= client_attributes.select question.key,
          options_for_select(question.choices, @client.ethnicity),
          {},
          class: "mt-6 rounded-lg w-full p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::HOMELESSNESS_FIRST_TIME %>
        <%= form.label :homelessness_first_time, question.text,
          class: "block leading-tight font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label :homelessness_first_time, choice %>
            <%= form.radio_button :homelessness_first_time, choice == "Yes", 
                class: "h-10 w-10 mr-8 text-indigo-600",
                checked: @intake.homelessness_first_time == choice %>
          <% end %>
        </div>
      </div>

      <div class="text-gray-700">
        <% question = Intake::HOMELESSNESS_HOW_LONG_THIS_TIME %>
        <%= form.label :how_long_this_time, question.text,
          class: "block leading-tight font-semibold"
        %>
        <%= form.text_field :how_long_this_time,
          size: 23, 
          value: @intake.how_long_this_time,
          placeholder: question.placeholder,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::HOMELESSNESS_EPISODES_LAST_THREE_YEARS %>
        <%= form.label :episodes_last_three_years_fewer_than_four_times, question.text,
          class: "block leading-tight font-semibold" %>
        <div class="mt-4 p-4 flex flex-1 flex-col space-y-8">
          <% question.choices.each do |choice| %>
            <div>

              <%= form.label :episodes_last_three_years_fewer_than_four_times, choice %>
              <%= form.radio_button :episodes_last_three_years_fewer_than_four_times,
                choice == "Fewer than 4 times",
                class: "h-10 w-10 text-indigo-600",
                checked: @intake.episodes_last_three_years_fewer_than_four_times == choice %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="text-gray-700">
        <% question = Intake::HOMELESSNESS_EPISODES_HOW_LONG %>
        <%= form.label question.key, question.text,
          class: "block leading-tight font-semibold"
        %>
        <%= form.text_field question.key,
          size: 23, 
          value: @intake.total_how_long_shelters_or_streets,
          placeholder: question.placeholder,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::SLEEP_LAST_NIGHT %>
        <%= form.label question.key, question.text,
          class: "block leading-tight font-semibold"  %>
        <ul class="p-4 flex flex-1 flex-col space-y-12 p-12 text-6xl">
          <% question.choices.each do |choice| %>
            <li>
              <%= form.label question.key, choice %>
              <%= form.radio_button question.key,
                choice, 
                class: "h-10 w-10 text-indigo-600",
                checked: @intake.where_did_you_sleep_last_night == choice %>
            </li>
          <% end %>
          <li class="flex flex-1 items-center relative">
            <div class="absolute inset-y-0 left-8 flex items-center pointer-events-none">
              <span class="text-gray-500 text-5xl">
                Other:
              </span>
            </div>
            <%= form.text_field question.key,
              value: @intake.where_did_you_sleep_last_night&.starts_with?("Other:") && @intake.where_did_you_sleep_last_night,
              id: "#{question.key}_other_text_field",
              class: "flex-1 focus:ring-indigo-500 focus:border-indigo-500 block mr-8 pl-48 py-6 border-gray-300 rounded-lg text-5xl"
            %>
            <%= form.radio_button question.key,
              "other_radio",
              id: "#{question.key}_other_radio",
              checked: @intake.where_did_you_sleep_last_night&.starts_with?("Other:"),
              class: "h-10 w-10 text-indigo-600"
            %>
          </li>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::CITY_LAST_NIGHT %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold"
        %>
        <%= client_attributes.text_field question.key,
          size: 23, 
          value: @intake.what_city_did_you_sleep_in_last_night,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::WHY_NOT_SHELTER %>
        <%= form.label question.key, question.text, 
          class: "block leading-tight font-semibold" %>
        <ul class="flex flex-1 flex-col w-full space-y-12 p-12 text-6xl">
          <% question.choices.each do |reason| %>
            <li class="flex flex-1 space-x-10 items-baseline">
              <%= form.check_box question.key, 
                {multiple: true, class: "w-11 h-11 text-indigo-600"},
                reason, 
                nil
              %>
              <%= form.label question.key, reason %>
            </li>
          <% end %>
          <li class="flex flex-1 items-center relative">
            <div class="absolute inset-y-0 left-28 flex items-center pointer-events-none">
              <span class="text-gray-500 text-5xl">
                Other:
              </span>
            </div>
            <% other_checked = @intake.why_not_shelter.find {|r| r.starts_with?("Other:") } %>
            <%= form.check_box question.key, 
              {
                multiple: true, 
                id: "why_not_shelter_other_checkbox",
                checked: other_checked,
                value: other_checked && @intake.why_not_shelter,
                class: "w-11 h-11 text-indigo-600"
              },
              "other_checkbox"
            %>
            <input type="text" 
              value="<%= other_checked %>"
              id="<%= "#{question.key}_other_text_field" %>"
              class="w-full focus:ring-indigo-500 focus:border-indigo-500 block
                pl-44 py-6 border-gray-300 rounded-lg text-5xl">
          </li>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::ARE_YOU_WORKING %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= form.select question.key, 
          options_for_select(
            Intake::ARE_YOU_WORKING.choices, 
            selected: @intake.are_you_working
          ),
          {},
          class: "mt-6 bg-white rounded-lg w-full p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::VETERAN %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.armed_forces == choice %>
          <% end %>
        </div>
      </div>

      <div class="text-gray-700">
        <% question = Intake::ACTIVE_DUTY %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.active_duty == choice %>
          <% end %>
        </div>
      </div>

      <div class="text-gray-700">
        <% question = Intake::SUBSTANCE_ABUSE %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
              class: "h-10 w-10 mr-8",
              checked: @intake.substance_abuse == choice %>
          <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::CHRONIC_HEALTH_CONDITION %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.chronic_health_condition == choice %>
        <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::MENTAL_HEALTH_CONDITION %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.mental_health_condition == choice %>
          <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::MENTAL_HEALTH_DISABILITY %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes",
                class: "h-10 w-10 mr-8",
                checked: @intake.mental_health_disability == choice %>
            <% end %>
        </ul>
      </div>
      <div class="text-gray-700">
        <% question = Intake::PHYSICAL_DISABILITY %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.physical_disability == choice %>
            <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::DEVELOPMENTAL_DISABILITY %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <ul class="p-4 flex flex-1">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.developmental_disability == choice %>
            <% end %>
        </ul>
      </div>

      <div class="text-gray-700">
        <% question = Intake::FLEEING_DOMESTIC_VIOLENCE %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice == "Yes", 
                class: "h-10 w-10 mr-8",
                checked: @intake.fleeing_domestic_violence == choice %>
          <% end %>
        </div>
      </div>

      <div class="w-full text-gray-700">
        <h3 class="text-6xl leading-6 font-medium text-gray-900">
          Family Members
        </h3>
        <p class="mt-8 text-5xl text-gray-500">
          If client has family currently with them, please add them below.
        </p>
        <div id="family_members" class="mt-16"></div>
        <a id="add_family_member" class="btn btn-outline">
          + Add Family Member
        </a>
      </div>

      <div class="w-full text-gray-700">
        <% question = Intake::NUM_ADULTS_HOUSEHOLD %>
        <%= form.label question.key, question.text,
          class: "block leading-relaxed font-semibold" %>
        <%= form.number_field question.key, 
          min: 0, step: 1, 
          class: "mt-4 rounded-lg w-full p-8 text-6xl", 
          value: @intake.num_adults_in_household,
          placeholder: question.placeholder 
        %>
      </div>

      <div class="w-full text-gray-700">
        <% question = Intake::NUM_CHILDREN_HOUSEHOLD %>
        <%= form.label question.key, question.text,
          class: "block leading-relaxed font-semibold" %>
        <%= form.number_field question.key, 
          min: 0, step: 1, 
          class: "mt-4 rounded-lg w-full p-8 text-6xl", 
          value: @intake.num_children_in_household,
          placeholder: question.placeholder 
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::LAST_PERMANENT_RESIDENCE_COUNTY %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold"
        %>
        <%= form.text_field question.key,
          value: @intake.last_permanent_residence_county,
          placeholder: question.placeholder,
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>

      <div class="text-gray-700">
        <% question = Intake::BUS_PASS %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice, 
                class: "h-10 w-10 mr-8",
                checked: @intake.bus_pass == choice %>
          <% end %>
        </div>
      </div>

      <div class="text-gray-700">
        <% question = Intake::KING_SOOPERS_CARD %>
        <%= form.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <div class="p-4">
          <% question.choices.each do |choice| %>
            <%= form.label question.key, choice %>
            <%= form.radio_button question.key, choice, 
                class: "h-10 w-10 mr-8",
                checked: @intake.king_soopers_card == choice %>
          <% end %>
        </div>
      </div>

      <!-- voucher-specific questions -->
      <%= form.fields_for :voucher, @voucher do |voucher_attributes| %>
      <div class="w-full text-gray-700">
        <% question = Intake::CHECK_IN %>
        <%= voucher_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= voucher_attributes.date_field question.key,
          value: [@swap.start_date, Date.current].max, 
          min: [@swap.start_date, Date.current].max,
          max: @swap.end_date - 1,
          class: "mt-4 w-full rounded-lg p-8 text-6xl" %>
      </div>

      <div class="w-full text-gray-700">
        <% question = Intake::CHECK_OUT %>
        <%= voucher_attributes.label question.key, question.text,
          class: "block leading-snug font-semibold" %>
        <%= voucher_attributes.date_field question.key,
          value: @swap.end_date,
          min: [@swap.end_date, Date.current].min,
          max: @swap.end_date,
          class: "mt-4 w-full rounded-lg p-8 text-6xl" %>
      </div>

      <div class="w-full text-gray-700">
        <% question = Intake::MOTEL_ID %>
        <%= voucher_attributes.label question.key, question.text,
          class: "block leading-relaxed font-semibold" %>
        <%= voucher_attributes.select question.key, options_for_select(@motels, selected: @motel&.id, disabled: @disabled),
          {},
          class: "mt-4 w-full rounded-lg p-8 text-6xl"
        %>
      </div>
    <% end %>

      <div class="w-full text-gray-700">
        <% question = Intake::PHONE_NUMBER %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-relaxed font-semibold"  %>
        <%= client_attributes.telephone_field question.key,
          class: "w-full rounded-lg p-8 text-6xl" %>
      </div>

      <div class="w-full text-gray-700">
        <% question = Intake::EMAIL %>
        <%= client_attributes.label question.key, question.text,
          class: "block leading-relaxed font-semibold"  %>
        <%= client_attributes.email_field question.key,
          class: "w-full rounded-lg p-8 text-6xl" %>
      </div>
    <% end %>

    <!-- end voucher-specific questions -->
    <div class="actions mt-12">
      <%= form.submit 'Submit', class: 'w-full btn btn-blue h-32 text-6xl' %>
    </div>
  </div>
<% end %>


<div id="template_family_member" class="hidden flex flex-1 flex-col space-y-2">
  <label for="intake[survey][family_members][replace][name]">
    <p class="block">Name</p>
  </label>
  <input name="intake[survey][family_members][replace][name]" class="w-full rounded-lg focus:ring-indigo-500 focus:border-indigo-500">

  <label for="intake[survey][family_members][replace][relationship]">
    <p class="block">Relationship</p>
  </label>
  <input name="intake[survey][family_members][replace][relationship]" class="w-full rounded-lg focus:ring-indigo-500 focus:border-indigo-500">

  <label for="intake[survey][family_members][replace][date_of_birth]">
    <p class="block">Date of birth</p>
  </label>
  <input type="date" name="intake[survey][family_members][replace][date_of_birth]" class="w-full rounded-lg p-3 text-6xl text-gray-400 focus:ring-indigo-500 focus:border-indigo-500">

  <label for="intake[survey][family_members][replace][gender]">
    <p class="block">Gender Identity</p>
  </label>
  <select class="w-full rounded-lg p-3 text-6xl" name="intake[survey][family_members][replace][gender]">
    <option value="Female">Female</option>
    <option value="Male">Male</option>
    <option value="Trans Female (MTF)">Trans Female (MTF)</option>
    <option value="Trans Male (FTM)">Trans Male (FTM)</option>
    <option value="Gender Non-Conforming">Gender Non-Conforming</option>
    <option value="Client Doesn't Know">Client Doesn't Know</option>
    <option value="Client Refused">Client Refused</option>
  </select>

  <label for="intake[survey][family_members][replace][race][]">
    <p class="block">Race</p>
  </label>

  <ul class="flex flex-1 flex-col w-full p-3 text-6xl text-gray-700">
    <li class="flex flex-1 items-baseline">
      <input class="w-11 h-11 text-indigo-600" type="checkbox" value="American Indian or Alaskan Native" name="intake[survey][family_members][replace][race][]">
      <label for="intake[survey][family_members][replace][race][]">American Indian or Alaskan Native</label>
    </li>
    <li class="flex flex-1 items-baseline">
      <input class="w-11 h-11 text-indigo-600" type="checkbox" value="Asian" name="intake[survey][family_members][replace][race][]">
      <label for="intake[survey][family_members][replace][race][]">Asian</label>
    </li>
  </ul>
</div>

<%= javascript_pack_tag 'intake_form' %>
